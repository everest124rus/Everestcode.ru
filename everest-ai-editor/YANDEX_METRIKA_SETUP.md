# Инструкция по настройке целей Яндекс Метрики

## Список целей для создания

Вам нужно создать следующие цели в Яндекс Метрике (тип: **JavaScript-событие**):

### 1. Первый запрос AI
- **Название**: Первый запрос AI
- **Идентификатор**: `ai_first_request`
- **Описание**: Отслеживает первый запрос пользователя к AI ассистенту

### 2. Регистрация
- **Название**: Регистрация
- **Идентификатор**: `auth_register`
- **Описание**: Отслеживает регистрацию нового пользователя

### 3. Нажатие на кнопку Beta
- **Название**: Нажатие на кнопку Beta
- **Идентификатор**: `feedback_open`
- **Описание**: Отслеживает нажатие на кнопку Beta (логотип Everest AI)

### 4. Попытка использовать GigaChat Pro
- **Название**: Попытка использовать GigaChat Pro
- **Идентификатор**: `ai_gigachat_pro_attempt`
- **Описание**: Отслеживает попытку использовать модель GigaChat Pro

## Как создать цели в Яндекс Метрике

1. Войдите в Яндекс Метрику: https://metrika.yandex.ru/
2. Выберите ваш счетчик (ID: **104338022**)
3. Перейдите в раздел **Цели** в левом меню
4. Нажмите кнопку **Добавить цель**

Для каждой цели выполните следующие шаги:

### Шаг 1: Название цели
Введите название цели (например, "Первый запрос AI")

### Шаг 2: Тип цели
Выберите тип: **JavaScript-событие**

### Шаг 3: Идентификатор цели
Введите идентификатор цели (например, `ai_first_request`)

**ВАЖНО**: Идентификатор должен точно совпадать с идентификатором в коде!

### Шаг 4: Код цели
Под полем с идентификатором появится строка **Код цели для сайта**:
```
ym(104338022, 'reachGoal', 'ai_first_request');
```

Этот код уже реализован в проекте, вам не нужно его добавлять вручную.

### Шаг 5: Сохранение
Нажмите кнопку **Добавить цель**

## Список всех идентификаторов целей

Вот полный список всех идентификаторов, которые используются в коде:

| Название | Идентификатор | Где вызывается |
|----------|---------------|----------------|
| Первый запрос AI | `ai_first_request` | AIPanel.tsx - при первом запросе |
| Регистрация | `auth_register` | AuthModal.tsx - при успешной регистрации |
| Нажатие на кнопку Beta | `feedback_open` | Sidebar.tsx - при клике на логотип |
| Попытка использовать GigaChat Pro | `ai_gigachat_pro_attempt` | AIPanel.tsx - при выборе GigaChat Pro |
| Вход в систему | `auth_login` | AuthModal.tsx - при успешном входе |
| Авторизация через Telegram | `auth_telegram` | AuthModal.tsx - при авторизации через Telegram |
| Использование AI ассистента | `ai_assistant_use` | AIPanel.tsx - при любом использовании AI |
| Попытка использовать GigaChat Max | `ai_gigachat_max_attempt` | AIPanel.tsx - при выборе GigaChat Max |
| Скачивание файла | `file_download` | Sidebar.tsx - при скачивании файла |

## Проверка работы целей

После создания целей в Яндекс Метрике:

1. Подождите несколько минут (Метрика начнет сбор статистики)
2. Выполните действие на сайте (например, отправьте первый запрос AI)
3. Проверьте в консоли браузера (F12) - должны появиться сообщения:
   ```
   ✅ Yandex Metrika goal sent (ym): ai_first_request
   ```
4. В Яндекс Метрике перейдите в раздел **Отчеты** → **Цели** и проверьте, что цель сработала

## Технические детали

### Функция trackGoal

Функция `trackGoal` находится в файле `src/utils/yandexMetrika.ts` и автоматически:
- Ждет загрузки Яндекс Метрики (если она еще не загружена)
- Отправляет событие через `ym(104338022, 'reachGoal', goalName)`
- Логирует результат в консоль для отладки

### Номер счетчика

ID счетчика Яндекс Метрики: **104338022**

Этот номер используется во всех вызовах `trackGoal`.

## Устранение проблем

### Цели не срабатывают

1. **Проверьте консоль браузера** (F12) - должны быть сообщения о отправке целей
2. **Проверьте, что Яндекс Метрика загружена** - в консоли не должно быть ошибок
3. **Проверьте идентификаторы** - они должны точно совпадать с идентификаторами в Метрике
4. **Подождите несколько минут** - Метрика может задержать сбор статистики

### Ошибки в консоли

Если видите ошибки типа `ym is not defined`:
- Проверьте, что скрипт Яндекс Метрики загружен в `public/index.html`
- Убедитесь, что нет блокировщиков рекламы, которые могут блокировать Метрику

## Дополнительная информация

Все константы целей определены в файле `src/utils/yandexMetrika.ts` в объекте `YM_EVENTS`.

Для добавления новой цели:
1. Добавьте константу в `YM_EVENTS`
2. Вызовите `trackGoal(YM_EVENTS.NEW_GOAL)` в нужном месте кода
3. Создайте цель в Яндекс Метрике с тем же идентификатором

